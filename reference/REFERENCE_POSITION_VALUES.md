# Reference Image Position Analysis (KoPub 기준 이미지)

기준 이미지(`file_52...jpg`)에서 추출한 red-box 54개 키(`reference/redbox_crops/key_001..054.png`)를 대상으로,
기호 위치를 정량화했어요.

> 방법: 각 키(45x45)에서 내부 영역(8px margin)만 사용 → 저명도 픽셀 연결요소 분석 →
> 본문 글리프 bbox(최대 컴포넌트) + 기호 후보 컴포넌트(소형) 분리 → 정규화 좌표 계산

---

## 산출 파일

- 상세 raw 값: `reference/position_analysis_v2.csv`
  - 컬럼: `idx,pos,bx0,by0,bx1,by1,x_ratio,gap`
- 보조(초안) 파일: `reference/position_analysis.csv`

---

## 핵심 위치값 요약

유효 검출(분리된 기호) 기준:
- 총 54개 중 46개에서 top/bottom 분리 검출
- 8개는 기호가 본문과 붙어서 `merged` 판정

### Top 기호(윗기호)
- 샘플 수: 25
- `x_ratio` 평균: **0.575**  (본문 bbox 기준)
- `gap` 평균: **+1.56px** (본문 상단에서 위쪽으로)

### Bottom 기호(아랫기호)
- 샘플 수: 21
- `x_ratio` 평균: **0.525**
- `gap` 평균: **-1.10px**
  - 음수는 본문과 **겹치거나 거의 붙어있는 상태**를 의미

---

## 해석 (튜닝용)

1. **X 위치 경향**
   - 윗기호 중심: 본문 폭의 약 **57.5%** 지점
   - 아랫기호 중심: 본문 폭의 약 **52.5%** 지점
   - 즉, 기준 이미지에서 윗기호가 아랫기호보다 약간 오른쪽 경향

2. **Y 간격 경향**
   - 윗기호: 약 +1~2px 떠 있음
   - 아랫기호: 0px 또는 약간 겹침(negative gap)
   - JB님 기준("거의 붙되 겹치지 않음")에 맞추면,
     - top 목표 gap: **+1px 내외**
     - bottom 목표 gap: **0~+1px** 권장

3. **merged 케이스(8개)**
   - 저해상도(45x45) + 안티앨리어싱으로 기호 분리가 안 된 케이스
   - 이 키들은 고해상도 crop(2x~3x)로 재추출하면 더 정확히 분리 가능

---

## 바로 적용 가능한 1차 목표값

기준 이미지 기반 1차 타겟(그룹 공통 기준선):
- `top_x_ratio_ref = 0.58`
- `bot_x_ratio_ref = 0.53`
- `top_gap_ref = +1px`
- `bot_gap_ref = 0px` (최대 +1px)

이 값을 출발점으로 G1a~G4b 그룹별 오프셋만 미세 조정하면 돼요.
