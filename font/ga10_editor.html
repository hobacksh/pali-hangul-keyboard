<!doctype html><html><head><meta charset='utf-8'><title>Ga10 Editor</title>
<style>
  :root{--left:220px}
  *{box-sizing:border-box}
  body{font-family:sans-serif;margin:0}
  .wrap{display:grid;grid-template-columns:var(--left) 1fr;min-height:100vh}
  .left{padding:10px 10px 16px 10px;border-right:1px solid #ddd;background:#fff}
  .left h2{margin:0 0 8px 0;font-size:15px}
  .preview-box{border:1px solid #ddd;background:#fff}
  .preview-box iframe{width:100%;height:calc(100vh - 64px);border:0;display:block}
  .right{position:sticky;top:0;height:100vh;overflow:auto;padding:6px;background:#fafafa}
  .toolbar{display:flex;gap:6px;align-items:center;margin-bottom:6px;position:sticky;top:0;background:#fafafa;padding-bottom:4px}
  button{padding:5px 7px;font-size:12px}
  #msg{font-size:12px;color:#444}
  .table-wrap{overflow-x:auto;background:#fff;border:1px solid #ddd}
  table{border-collapse:collapse;min-width:620px;width:100%;table-layout:fixed}
  td,th{border:1px solid #ddd;padding:3px;font-size:10px;vertical-align:middle}
  th:nth-child(1),td:nth-child(1){width:70px}
  th:nth-child(2),td:nth-child(2){width:120px}
  th:nth-child(3),td:nth-child(3),th:nth-child(4),td:nth-child(4),th:nth-child(5),td:nth-child(5),th:nth-child(6),td:nth-child(6){width:70px}
  th{position:sticky;top:30px;background:#f3f3f3;z-index:1}
  input{width:56px;padding:2px;font-size:10px}
  .id{font-family:ui-monospace,Menlo,monospace;font-size:10px;white-space:nowrap}
</style>
</head><body>
<div class='wrap'>
  <section class='left'>
    <h2>가계열 10개 미리보기 (실폰트)</h2>
    <div class='preview-box'>
      <iframe id='pv' src='./web_ga_series_preview_v288.html'></iframe>
    </div>
  </section>

  <aside class='right'>
    <div class='toolbar'>
      <button onclick='applyFont()'>저장 + 폰트 반영</button>
      <span id='msg'></span>
    </div>

    <div class='table-wrap'>
      <table id='tbl'>
        <thead>
          <tr><th>ID</th><th>설명</th><th>x</th><th>y</th><th>width(u)</th><th>height(u)</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </aside>
</div>

<script>
const rows=[
 ['id1_mac','1) 가+장음 (mac)'],
 ['id2_top','2) 가+윗점+장음 (top)'],
 ['id2_mac','2) 가+윗점+장음 (mac)'],
 ['id3_top','3) 가+윗점'],
 ['id4_bot','4) 간+아랫점'],
 ['id5_top','5) 강+윗점'],
 ['id6_tri','6) 강+아랫역삼각형'],
 ['id7_mac','7) 까+장음'],
 ['id8_tilde','8) 깐+아랫물결'],
 ['id9_tri','9) 깡+아랫역삼각형'],
 ['id10_tilde','10) 낀+아랫물결']
];

async function load(){
 const r=await fetch('/params'); const p=await r.json();
 const tb=document.querySelector('#tbl tbody'); tb.innerHTML='';
 rows.forEach(([id,label])=>{
  const v=p[id]||{x:0,y:0,width:100,height:100};
  tb.insertAdjacentHTML('beforeend',
   `<tr>
      <td class='id'>${id}</td>
      <td>${label}</td>
      <td><input id='${id}_x' value='${v.x}'></td>
      <td><input id='${id}_y' value='${v.y}'></td>
      <td><input id='${id}_w' value='${v.width}'></td>
      <td><input id='${id}_h' value='${v.height}'></td>
    </tr>`)
 })
}

function collect(){
 const p={};
 rows.forEach(([id])=>p[id]={
   x:+document.getElementById(id+'_x').value,
   y:+document.getElementById(id+'_y').value,
   width:+document.getElementById(id+'_w').value,
   height:+document.getElementById(id+'_h').value
 });
 return p
}

async function saveParams(){
 const r=await fetch('/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(collect())});
 return await r.json()
}

async function applyFont(){
 document.getElementById('msg').textContent='적용중...';
 const s=await saveParams();
 if(!s.ok){document.getElementById('msg').textContent='저장 실패'; return;}
 const r=await fetch('/apply',{method:'POST'});
 const j=await r.json();
 document.getElementById('msg').textContent=j.ok?'폰트 반영 완료':'반영 실패';
 document.getElementById('pv').src='./web_ga_series_preview_v288.html?t='+(Date.now())
}

load();
</script>
</body></html>