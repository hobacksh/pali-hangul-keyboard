<!doctype html><html><head><meta charset='utf-8'><title>PaliHangul Editor</title>
<style>
  *{box-sizing:border-box}
  body{font-family:sans-serif;margin:0;background:#fafafa;overflow-x:hidden}
  .page{padding:12px;max-width:100vw}
  h2{margin:0 0 10px 0}
  .nav{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap}
  .nav button{padding:7px 10px;font-size:12px}
  .nav .on{background:#111;color:#fff;border-color:#111}
  .subnav{display:flex;gap:6px;margin:-2px 0 10px 0;flex-wrap:wrap}
  .subnav button{padding:5px 8px;font-size:11px}
  .subnav .on{background:#2b6cb0;color:#fff;border-color:#2b6cb0}
  .meta-row{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:8px;flex-wrap:wrap}
  .preset{font-size:12px;color:#222;background:#fff;border:1px solid #ddd;border-radius:999px;padding:4px 10px}
  .msg{font-size:12px;color:#444;margin-bottom:10px}
  #root{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;align-items:start;width:100%}
  .card{background:#fff;border:1px solid #ddd;border-radius:8px;padding:12px;width:100%;max-width:100%;min-width:0;overflow:hidden}
  .sample{font-family:PH,serif;font-size:72px;line-height:1.1;text-align:center;margin:2px 0 10px 0}
  .meta{font-size:13px;color:#333;font-weight:600;text-align:center;margin-bottom:6px}
  .hoverxy{font-size:11px;color:#555;text-align:center;margin-bottom:8px}
  .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px;margin-bottom:10px}
  .k{font-size:10px;color:#666}
  input{width:100%;padding:5px 6px;font-size:12px}
  .copy{display:flex;gap:6px;justify-content:center;align-items:center;margin-bottom:6px;flex-wrap:wrap}
  .copy select{max-width:320px;padding:5px;font-size:12px}
  .hover-actions{display:flex;justify-content:center;margin-bottom:8px}
  .btns{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
  button{padding:6px 10px;font-size:12px}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:9999}
  .modal.open{display:flex}
  .modal-box{background:#fff;border-radius:10px;padding:12px;min-width:760px;max-width:92vw}
  .modal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px}
  .zoom-wrap{position:relative;border:1px solid #ddd;background:#fff;height:360px;overflow:hidden}
  .coord-plane{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);border:1px dashed #eee}
  .zoom-glyph{position:absolute;left:0;bottom:0;font-family:PH,serif;line-height:1;user-select:none}
  .cross{position:absolute;transform:translate(-50%,-50%);pointer-events:none;display:none}
  .cross.mark{color:#d00}
  .modal-tools{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:8px 0}
  .coord{font-size:12px;color:#333}
  .modal2{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:10000}
  .modal2.open{display:flex}
  .modal2-box{background:#fff;border-radius:10px;padding:12px;min-width:720px;max-width:94vw}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
  .chips{display:flex;gap:6px;flex-wrap:wrap}
  .chips label{font-size:12px;border:1px solid #ddd;border-radius:999px;padding:4px 8px;background:#fff}
  .pick2{position:relative;border:1px solid #ddd;height:220px;display:flex;align-items:center;justify-content:center}
  .pick2-glyph{font-family:PH,serif;font-size:170px;line-height:1}
  .pick2-cross{position:absolute;width:12px;height:12px;border-radius:999px;background:#d00;transform:translate(-50%,-50%);display:none}

</style>

<div class='modal2' id='addCardModal' onclick='closeAddCardByBackdrop(event)'>
  <div class='modal2-box'>
    <div class='modal-head'>
      <div style='font-weight:600'>카드 추가</div>
      <button onclick='closeAddCardModal()'>닫기</button>
    </div>
    <div class='row'>
      <label>계열</label>
      <select id='add_group'></select>
      <label>글자</label>
      <input id='add_base' style='width:100px' placeholder='예: 다'>
    </div>
    <div class='row'>
      <label>기호 (최대 2개)</label>
      <div class='chips' id='add_marks'></div>
    </div>
    <div class='row'>
      <label>기본 위치 찍기</label>
      <span class='coord' id='add_pick_coord'>x: -, y: -</span>
    </div>
    <div class='pick2' id='add_pick' onmousemove='onAddPickMove(event)' onclick='onAddPickClick(event)'>
      <div class='pick2-glyph' id='add_pick_glyph'>가</div>
      <div class='pick2-cross' id='add_pick_cross'></div>
    </div>
    <div class='row' style='justify-content:flex-end;margin-top:10px'>
      <button onclick='createCardFromModal()'>등록</button>
    </div>
  </div>
</div>

<script>
const t = new URLSearchParams(location.search).get('t') || Date.now().toString();
const st = document.createElement('style');
st.textContent = `@font-face{font-family:PH;src:url('/font.otf?t=${t}') format('opentype')}`;
document.head.appendChild(st);
</script>
</head><body>
<div class='page'>
<h2>빠알리 한글 폰트 편집기</h2>
<div style='margin-bottom:8px'>
  <button onclick="applyAll()">전체 저장 + 폰트 반영</button>
  <button onclick="openAddCardModal()">카드 추가</button>
</div>
<div class='nav'>
  <button id='tab_all' onclick="setGroup('all')">전체</button>
  <button id='tab_ga' class='on' onclick="setGroup('ga')">가계열</button>
  <button id='tab_na'  onclick="setGroup('na')">나계열</button>
  <button id='tab_da'  onclick="setGroup('da')">다계열</button>
  <button id='tab_ra'  onclick="setGroup('ra')">라계열</button>
  <button id='tab_ma'  onclick="setGroup('ma')">마계열</button>
  <button id='tab_ba'  onclick="setGroup('ba')">바계열</button>
  <button id='tab_sa'  onclick="setGroup('sa')">사계열</button>
  <button id='tab_a'  onclick="setGroup('a')">아계열</button>
  <button id='tab_ja'  onclick="setGroup('ja')">자계열</button>
  <button id='tab_cha'  onclick="setGroup('cha')">차계열</button>
  <button id='tab_ka'  onclick="setGroup('ka')">카계열</button>
  <button id='tab_ta'  onclick="setGroup('ta')">타계열</button>
  <button id='tab_pa'  onclick="setGroup('pa')">파계열</button>
  <button id='tab_ha'  onclick="setGroup('ha')">하계열</button>
</div>
<div class='subnav' id='viewNav'></div>
<div class='meta-row'>
  <div class='preset' id='presetBadge'>preset-00000000-000</div>
  <div class='msg' id='msg'>항목별 저장/반영이 가능합니다.</div>
</div>
<div id='root'></div>
</div>

<div class='modal' id='pickModal' onclick='closePickerByBackdrop(event)'>
  <div class='modal-box'>
    <div class='modal-head'>
      <div id='pickTitle' style='font-weight:600'>정밀 편집</div>
      <button onclick='closePicker()'>닫기</button>
    </div>
    <div class='zoom-wrap' id='zoomWrap' onmousemove='onPickerMove(event)' onclick='onPickerClick(event)'>
      <div class='coord-plane' id='coordPlane'>
        <div class='zoom-glyph' id='zoomGlyph'></div>
        <div class='cross mark' id='pickCross'></div>
      </div>
    </div>
    <div class='modal-tools'>
      <span class='coord' id='pickCoord'>x: -, y: -</span>
      <label>w</label><input id='pickW' style='width:72px' type='number' oninput='onPickSizeChange()'>
      <label>h</label><input id='pickH' style='width:72px' type='number' oninput='onPickSizeChange()'>
      <label>스냅</label>
      <select id='snapSel'>
        <option value='1'>1px</option><option value='5'>5px</option><option value='10'>10px</option>
      </select>
      <button onclick='nudge(-1,0)'>←</button><button onclick='nudge(1,0)'>→</button><button onclick='nudge(0,1)'>↑</button><button onclick='nudge(0,-1)'>↓</button>
      <button onclick='applyPickedToInputs()'>적용만</button>
      <button onclick='applyPickedAndSave()'>적용+저장</button>
    </div>
  </div>
</div>

<script>
const ITEMS = {
  ga: [
    {key:'ga1_mac', title:'1) 가+장음', sample:'가︠'},
    {key:'ga2_top', title:'2-a) 가+윗점+장음(윗점)', sample:'가̊︠'},
    {key:'ga2_mac', title:'2-b) 가+윗점+장음(장음)', sample:'가̊︠'},
    {key:'ga3_top', title:'3) 가+윗점', sample:'가̊'},
    {key:'ga4_bot', title:'4) 간+아랫점', sample:'간̥'},
    {key:'ga5_top', title:'5) 강+윗점', sample:'강̊'},
    {key:'ga6_tri', title:'6) 강+아랫역삼각형', sample:'강ˑ'},
    {key:'ga7_mac', title:'7) 까+장음', sample:'까︠'},
    {key:'ga8_tilde', title:'8) 깐+아랫물결', sample:'깐̰'},
    {key:'ga9_tri', title:'9) 깡+아랫역삼각형', sample:'깡ˑ'},
    {key:'ga10_tilde', title:'10) 낀+아랫물결', sample:'낀̰'},
  ],
  na: [
    {key:'na1_mac', title:'1) 나+장음', sample:'나︠'},
    {key:'na2_bot', title:'2) 나+아랫점', sample:'나̥'},
    {key:'na3_bot', title:'3-a) 나+장음+아랫점(아랫점)', sample:'나̥︠'},
    {key:'na3_mac', title:'3-b) 나+장음+아랫점(장음)', sample:'나̥︠'},
    {key:'na4_mac', title:'4) 낙+장음', sample:'낙︠'},
    {key:'na5_bot', title:'5-a) 난+아랫점+아랫물결(아랫점)', sample:'난̥̰'},
    {key:'na5_tilde', title:'5-b) 난+아랫점+아랫물결(아랫물결)', sample:'난̥̰'},
    {key:'na6_bot', title:'6) 난+아랫점', sample:'난̥'},
    {key:'na7_tilde', title:'7) 난+아랫물결', sample:'난̰'},
    {key:'na8_mac', title:'8-a) 난+장음+아랫물결(장음)', sample:'난̰︠'},
    {key:'na8_tilde', title:'8-b) 난+장음+아랫물결(아랫물결)', sample:'난̰︠'},
    {key:'na9_bot', title:'9) 낫+아랫점', sample:'낫̥'},
    {key:'na10_bot', title:'10) 낭+아랫점', sample:'낭̥'},
    {key:'na11_tri', title:'11) 낭+역삼각형', sample:'낭ˑ'},
    {key:'na12_bot', title:'12) 냐+아랫점', sample:'냐̥'},
    {key:'na13_bot', title:'13-a) 냐+장음+아랫점(아랫점)', sample:'냐̥︠'},
    {key:'na13_mac', title:'13-b) 냐+장음+아랫점(장음)', sample:'냐̥︠'},
    {key:'na14_tilde', title:'14) 냣+아랫물결', sample:'냣̰'},
    {key:'na15_tilde', title:'15) 냥+아랫물결', sample:'냥̰'},
    {key:'na16_bot', title:'16-a) 누+장음+아랫점(아랫점)', sample:'누̥︠'},
    {key:'na16_mac', title:'16-b) 누+장음+아랫점(장음)', sample:'누̥︠'},
    {key:'na17_bot', title:'17) 니+아랫점', sample:'니̥'},
    {key:'na18_bot', title:'18) 네+아랫점', sample:'네̥'},
  ],
  da: [
    {key:'da1_mac', title:'1) 다+장음', sample:'다︠'},
    {key:'da2_top', title:'2) 다+윗점', sample:'다̊'},
    {key:'da3_top', title:'3-a) 다+장음+윗점(윗점)', sample:'다̊︠'},
    {key:'da3_mac', title:'3-b) 다+장음+윗점(장음)', sample:'다̊︠'},
    {key:'da4_top', title:'4) 담+윗점', sample:'담̊'},
    {key:'da5_top', title:'5) 닷+윗점', sample:'닷̊'},
    {key:'da6_top', title:'6) 당+윗점', sample:'당̊'},
    {key:'da7_top', title:'7) 도+윗점', sample:'도̊'},
    {key:'da8_bot', title:'8) 둣+아랫점', sample:'둣̥'},
    {key:'da9_mac', title:'9) 디+장음', sample:'디︠'},
    {key:'da10_bot', title:'10) 디+아랫점', sample:'디̥'},
    {key:'da11_top', title:'11) 디+윗점', sample:'디̊'},
    {key:'da12_top', title:'12) 딕+윗점', sample:'딕̊'},
    {key:'da13_bot', title:'13) 딧+아랫점', sample:'딧̥'},
    {key:'da14_top', title:'14) 딩+윗점', sample:'딩̊'},
    {key:'da15_top', title:'15) 데+윗점', sample:'데̊'},
    {key:'da16_mac', title:'16) 따+장음', sample:'따︠'},
    {key:'da17_bot', title:'17) 땃+아랫점', sample:'땃̥'},
    {key:'da18_bot', title:'18) 뚯+아랫점', sample:'뚯̥'},
    {key:'da19_mac', title:'19) 띠+장음', sample:'띠︠'},
    {key:'da20_bot', title:'20) 띠+아랫점', sample:'띠̥'},
    {key:'da21_bot', title:'21) 띳+아랫점', sample:'띳̥'},
    {key:'da22_bot', title:'22) 띤+아랫점', sample:'띤̥'},
  ],
  ra: [
    {key:'ra1_mac', title:'1) 라+장음', sample:'라︠'},
    {key:'ra2_mac', title:'2-a) 라+장음+아랫점(장음)', sample:'라̥︠'},
    {key:'ra2_bot', title:'2-b) 라+장음+아랫점(아랫점)', sample:'라̥︠'},
    {key:'ra3_double', title:'3) 랏+자음중복', sample:'랏ʺ'},
    {key:'ra4_tilde_top', title:'4) 로+윗물결', sample:'로̃'},
    {key:'ra5_double', title:'5) 로+자음중복', sample:'로ʺ'},
    {key:'ra6_mac', title:'6) 루+장음', sample:'루︠'},
    {key:'ra7_mac', title:'7-a) 리+장음+아랫점(장음)', sample:'리̥︠'},
    {key:'ra7_bot', title:'7-b) 리+장음+아랫점(아랫점)', sample:'리̥︠'},
  ],
  ma: [
    {key:'ma1_mac', title:'1) 마+장음', sample:'마︠'},
    {key:'ma2_tilde', title:'2) 만+아랫물결', sample:'만̰'},
    {key:'ma3_tri', title:'3) 망+역삼각형', sample:'망ˑ'},
    {key:'ma4_bot', title:'4) 뭇+아랫점', sample:'뭇̥'},
    {key:'ma5_mac', title:'5) 무+장음', sample:'무︠'},
    {key:'ma6_mac', title:'6) 물+장음', sample:'물︠'},
  ],
  ba: [
    {key:'ba1_mac', title:'1) 바+장음', sample:'바︠'},
    {key:'ba2_top', title:'2) 바+윗점', sample:'바̊'},
    {key:'ba3_top', title:'3-a) 바+장음+윗점(윗점)', sample:'바̊︠'},
    {key:'ba3_mac', title:'3-b) 바+장음+윗점(장음)', sample:'바̊︠'},
    {key:'ba4_mac', title:'4) 뱌+장음', sample:'뱌︠'},
    {key:'ba5_mac', title:'5) 발+장음', sample:'발︠'},
    {key:'ba6_mac', title:'6-a) 발+장음+아랫점(장음)', sample:'발̥︠'},
    {key:'ba6_bot', title:'6-b) 발+장음+아랫점(아랫점)', sample:'발̥︠'},
    {key:'ba7_top', title:'7) 보+윗점', sample:'보̊'},
    {key:'ba8_top', title:'8) 붕+윗점', sample:'붕̊'},
    {key:'ba9_top', title:'9) 부+윗점', sample:'부̊'},
    {key:'ba10_top', title:'10-a) 부+장음+윗점(윗점)', sample:'부̊︠'},
    {key:'ba10_mac', title:'10-b) 부+장음+윗점(장음)', sample:'부̊︠'},
    {key:'ba11_top', title:'11) 비+윗점', sample:'비̊'},
    {key:'ba12_top', title:'12) 빅+윗점', sample:'빅̊'},
    {key:'ba13_top', title:'13-a) 빈+윗점+아랫물결(윗점)', sample:'빈̰̊'},
    {key:'ba13_tilde', title:'13-b) 빈+윗점+아랫물결(아랫물결)', sample:'빈̰̊'},
    {key:'ba14_top', title:'14) 빈+윗점', sample:'빈̊'},
    {key:'ba15_top', title:'15) 빗+윗점', sample:'빗̊'},
    {key:'ba16_mac', title:'16) 빠+장음', sample:'빠︠'},
    {key:'ba17_bot', title:'17) 빤+아랫점', sample:'빤̥'},
    {key:'ba18_tilde', title:'18) 빤+아랫물결', sample:'빤̰'},
    {key:'ba19_bot', title:'19) 빳+아랫점', sample:'빳̥'},
    {key:'ba20_mac', title:'20) 뿌+장음', sample:'뿌︠'},
    {key:'ba21_tilde', title:'21) 뿐+아랫물결', sample:'뿐̰'},
    {key:'ba22_top', title:'22) 붓+윗점', sample:'붓̊'},
    {key:'ba23_top', title:'23) 베+윗점', sample:'베̊'},
  ],
  sa: [
    {key:'sa1_mac', title:'1) 사+장음', sample:'사︠'},
    {key:'sa2_tilde', title:'2) 산+아랫물결', sample:'산̰'},
    {key:'sa3_tri', title:'3) 상+역삼각형', sample:'상ˑ'},
    {key:'sa4_mac', title:'4) 실+장음', sample:'실︠'},
  ],
  a: [
    {key:'a1_mac', title:'1) 아+장음', sample:'아︠'},
    {key:'a2_tilde', title:'2) 안+아랫물결', sample:'안̰'},
    {key:'a3_bot', title:'3) 앗+아랫점', sample:'앗̥'},
    {key:'a4_double', title:'4) 야+자음중복', sample:'야ʺ'},
    {key:'a5_mac', title:'5) 야+장음', sample:'야︠'},
    {key:'a6_mac', title:'6-a) 야+장음+자음중복(장음)', sample:'야︠ʺ'},
    {key:'a6_double', title:'6-b) 야+장음+자음중복(자음중복)', sample:'야︠ʺ'},
    {key:'a7_tilde', title:'7) 얀+아랫물결', sample:'얀̰'},
    {key:'a8_caron', title:'8) 오+캐론', sample:'오̌'},
    {key:'a9_top', title:'9) 와+윗점', sample:'와̊'},
    {key:'a10_top', title:'10-a) 와+장음+윗점(윗점)', sample:'와̊︠'},
    {key:'a10_mac', title:'10-b) 와+장음+윗점(장음)', sample:'와̊︠'},
    {key:'a11_bot', title:'11) 완+아랫점', sample:'완̥'},
    {key:'a12_top', title:'12) 왕+윗점', sample:'왕̊'},
    {key:'a13_tri', title:'13) 왕+역삼각형', sample:'왕ˑ'},
    {key:'a14_bot', title:'14) 웃+아랫점', sample:'웃̥'},
    {key:'a15_caron', title:'15-a) 웃+캐론+아랫점(캐론)', sample:'웃̥̌'},
    {key:'a15_bot', title:'15-b) 웃+캐론+아랫점(아랫점)', sample:'웃̥̌'},
    {key:'a16_tilde', title:'16) 윈+아랫물결', sample:'윈̰'},
    {key:'a17_ya', title:'17) 이+야', sample:'이͆'},
    {key:'a18_ya', title:'18) 잉+야', sample:'잉͆'},
    {key:'a19_ya', title:'19-a) 잇+야+아랫점(야)', sample:'잇̥͆'},
    {key:'a19_bot', title:'19-b) 잇+야+아랫점(아랫점)', sample:'잇̥͆'},
    {key:'a20_top', title:'20) 윈+윗점', sample:'윈̊'},
  ],
  ja: [
    {key:'ja1_mac', title:'1) 자+장음', sample:'자︠'},
    {key:'ja2_top', title:'2-a) 자+장음+윗점(윗점)', sample:'자̊︠'},
    {key:'ja2_mac', title:'2-b) 자+장음+윗점(장음)', sample:'자̊︠'},
    {key:'ja3_mac', title:'3) 짜+장음', sample:'짜︠'},
    {key:'ja4_tilde', title:'4) 짠+아랫물결', sample:'짠̰'},
    {key:'ja5_tilde', title:'5) 찐+아랫물결', sample:'찐̰'},
    {key:'ja6_bot', title:'6) 찐+아랫점', sample:'찐̥'},
    {key:'ja7_mac', title:'7) 지+장음', sample:'지︠'},
  ],
  cha: [
    {key:'cha1_mac', title:'1) 차+장음', sample:'차︠'},
  ],
  ka: [
    {key:'ka1_mac', title:'1) 카+장음', sample:'카︠'},
  ],
  ta: [
    {key:'ta1_mac', title:'1) 타+장음', sample:'타︠'},
    {key:'ta2_mac', title:'2-a) 타+장음+아랫점(장음)', sample:'타̥︠'},
    {key:'ta2_bot', title:'2-b) 타+장음+아랫점(아랫점)', sample:'타̥︠'},
    {key:'ta3_bot', title:'3) 탑+아랫점', sample:'탑̥'},
    {key:'ta4_mac', title:'4-a) 티+장음+아랫점(장음)', sample:'티̥︠'},
    {key:'ta4_bot', title:'4-b) 티+장음+아랫점(아랫점)', sample:'티̥︠'},
    {key:'ta5_bot', title:'5) 티+아랫점', sample:'티̥'},
    {key:'ta6_bot', title:'6) 팅+아랫점', sample:'팅̥'},
    {key:'ta7_bot', title:'7) 타+아랫점', sample:'타̥'},
    {key:'ta8_bot', title:'8) 테+아랫점', sample:'테̥'},
  ],
  pa: [
    {key:'pa1_bot', title:'1) 폿+아랫점', sample:'폿̥'},
  ],
  ha: [
    {key:'ha1_mac', title:'1) 후+장음', sample:'후︠'},
    {key:'ha2_mac', title:'2) 히+장음', sample:'히︠'},
    {key:'ha3_mac', title:'3) 하+장음', sample:'하︠'},
  ]
};

let state = {};
let group = 'ga';
let view = 'all';
const hoverPos = {};
let picker = {open:false,key:null,x:0,y:0,w:140,h:140};
let addDraft = {x:null,y:null};

const VIEW_DEFS = [
  {key:'all', label:'전체', sig:null},
  {key:'mac', label:'글자+장음', sig:['mac']},
  {key:'top', label:'글자+윗점', sig:['top']},
  {key:'bot', label:'글자+아랫점', sig:['bot']},
  {key:'tilde', label:'글자+아랫물결', sig:['tilde']},
  {key:'tilde_top', label:'글자+윗물결', sig:['tilde_top']},
  {key:'tri', label:'글자+역삼각형', sig:['tri']},
  {key:'double', label:'글자+자음중복', sig:['double']},
  {key:'caron', label:'글자+캐론', sig:['caron']},
  {key:'ya', label:'글자+야', sig:['ya']},
  {key:'mac_top', label:'글자+장음+윗점', sig:['mac','top']},
  {key:'mac_bot', label:'글자+장음+아랫점', sig:['mac','bot']},
  {key:'mac_tilde', label:'글자+장음+아랫물결', sig:['mac','tilde']},
  {key:'mac_double', label:'글자+장음+자음중복', sig:['mac','double']},
  {key:'top_tilde', label:'글자+윗점+아랫물결', sig:['top','tilde']},
  {key:'bot_tilde', label:'글자+아랫점+아랫물결', sig:['bot','tilde']},
  {key:'bot_caron', label:'글자+캐론+아랫점', sig:['bot','caron']},
  {key:'bot_ya', label:'글자+야+아랫점', sig:['bot','ya']},
];
const MARK_ORDER = ['mac','top','bot','tilde','tilde_top','tri','double','caron','ya'];
const GROUP_ORDER=['ga','na','da','ra','ma','ba','sa','a','ja','cha','ka','ta','pa','ha'];
const GROUP_LABEL={ga:'가계열',na:'나계열',da:'다계열',ra:'라계열',ma:'마계열',ba:'바계열',sa:'사계열',a:'아계열',ja:'자계열',cha:'차계열',ka:'카계열',ta:'타계열',pa:'파계열',ha:'하계열'};
const MARK_LABEL={mac:'장음',top:'윗점',bot:'아랫점',tilde:'아랫물결',tilde_top:'윗물결',tri:'역삼각형',double:'자음중복',caron:'캐론',ya:'야'};
const MARK_CHAR={mac:'︠',top:'̊',bot:'̥',tilde:'̰',tilde_top:'̃',tri:'ˑ',double:'ʺ',caron:'̌',ya:'͆'};


function normalizeSig(marks){
  const uniq = [...new Set(marks)];
  uniq.sort((a,b)=>MARK_ORDER.indexOf(a)-MARK_ORDER.indexOf(b));
  return uniq.join('+');
}
function keyToMarkType(key){
  if(key.endsWith('_tilde_top')) return 'tilde_top';
  const s = key.split('_').pop();
  if(['mac','top','bot','tilde','tri','double','caron','ya'].includes(s)) return s;
  return null;
}
function stemKey(key){ return key.replace(/_(mac|top|bot|tilde|tri|double|caron|ya|tilde_top)$/,''); }
function comboSigMap(items){
  const byStem = {};
  items.forEach(it=>{
    const st = stemKey(it.key);
    const mt = keyToMarkType(it.key);
    if(!mt) return;
    byStem[st] = byStem[st] || [];
    byStem[st].push(mt);
  });
  const out = {};
  Object.keys(byStem).forEach(st=> out[st] = normalizeSig(byStem[st]));
  return out;
}
function buildViewNav(){
  const nav = document.getElementById('viewNav');
  nav.innerHTML = VIEW_DEFS.map(v=>`<button id='view_${v.key}' onclick="setView('${v.key}')">${v.label}</button>`).join('');
}
function filterItemsByView(items){
  if(view==='all') return items;
  const vd = VIEW_DEFS.find(v=>v.key===view);
  if(!vd || !vd.sig) return items;
  const target = normalizeSig(vd.sig);
  const sigs = comboSigMap(items);
  return items.filter(it => sigs[stemKey(it.key)] === target);
}
function setView(v){ view = v; render(); }


function currentPresetLabel(){
  const m = state && state.__meta ? state.__meta : null;
  if(!m) return 'preset-00000000-000';
  const date = (m.date || '00000000').toString();
  const seq = String(parseInt(m.seq || 0,10)).padStart(3,'0');
  return `preset-${date}-${seq}`;
}
function refreshPresetBadge(){
  const el=document.getElementById('presetBadge');
  if(el) el.textContent = currentPresetLabel();
}

function allItems(){ return Object.values(ITEMS).flat(); }
function sourceOptions(targetKey){
  const targetType = keyToMarkType(targetKey);
  return allItems()
    .filter(it => it.key !== targetKey)
    .filter(it => {
      const t = keyToMarkType(it.key);
      return targetType ? t === targetType : true;
    })
    .map(it => `<option value="${it.key}">${it.title} (${it.key})</option>`)
    .join('');
}
function card(it){
  const v = state[it.key] || {x:0,y:0,width:100,height:100};
  return `
  <div class='card' id='card_${it.key}'>
    <div class='sample' onmousemove="onSampleMove(event,'${it.key}')" onmouseleave="onSampleLeave('${it.key}')">${it.sample}</div>
    <div class='meta'>${it.title} (${it.key})</div>
    <div class='hoverxy' id='${it.key}_hover'>hover x: -, y: -</div>
    <div class='grid'>
      <div><div class='k'>x</div><input id='${it.key}_x' value='${v.x}'></div>
      <div><div class='k'>y</div><input id='${it.key}_y' value='${v.y}'></div>
      <div><div class='k'>width(u)</div><input id='${it.key}_w' value='${v.width}'></div>
      <div><div class='k'>height(u)</div><input id='${it.key}_h' value='${v.height}'></div>
    </div>
    <div class='copy'>
      <select id='${it.key}_src'><option value=''>다른 항목 값 불러오기…</option>${sourceOptions(it.key)}</select>
      <button onclick="copyFromSelected('${it.key}')">값 불러오기</button>
    </div>
    <div class='hover-actions'>
      <button onclick="openPicker('${it.key}')">정밀 편집</button>
    </div>
    <div class='btns'>
      <button onclick="saveOne('${it.key}')">저장</button>
      <button onclick="applyOne('${it.key}')">저장 + 폰트 반영</button>
    </div>
  </div>`;
}
function onSampleMove(evt,key){
  const r = evt.currentTarget.getBoundingClientRect();
  const x = evt.clientX - r.left;
  const y = r.bottom - evt.clientY;
  hoverPos[key] = {x, y};
  const el = document.getElementById(key+'_hover');
  if(el) el.textContent = `hover x:${x.toFixed(1)}px, y:${y.toFixed(1)}px`;
}
function onSampleLeave(key){
  const el = document.getElementById(key+'_hover');
  if(el) el.textContent = 'hover x: -, y: -';
}

const UPM = 1000;
const PICK_SCALE = 0.30; // 1 font-unit = 0.30 px in picker
function snap(n){ const s=Number(document.getElementById('snapSel')?.value||1); return Math.round(n/s)*s; }
function setupCoordPlane(){
  const plane=document.getElementById('coordPlane');
  const glyph=document.getElementById('zoomGlyph');
  const px = UPM * PICK_SCALE;
  plane.style.width = `${px}px`;
  plane.style.height = `${px}px`;
  glyph.style.fontSize = `${px}px`;
}
function openPicker(key){
  picker={open:true,key,x: Number(document.getElementById(key+'_x').value||0), y:Number(document.getElementById(key+'_y').value||0), w:Number(document.getElementById(key+'_w').value||140), h:Number(document.getElementById(key+'_h').value||140)};
  const it = allItems().find(v=>v.key===key);
  document.getElementById('pickTitle').textContent = `정밀 편집: ${it?it.title:key} (${key})`;
  document.getElementById('zoomGlyph').textContent = it?it.sample:'';
  document.getElementById('pickModal').classList.add('open');
  setupCoordPlane();
  document.getElementById('pickW').value = Math.round(picker.w);
  document.getElementById('pickH').value = Math.round(picker.h);
  updatePickerUI();
}
function closePicker(){ picker.open=false; document.getElementById('pickModal').classList.remove('open'); }
function closePickerByBackdrop(evt){ if(evt.target.id==='pickModal') closePicker(); }
function markerSvg(mt, wPx, hPx){
  const w = Math.max(8, wPx), h = Math.max(8, hPx);
  const sw = Math.max(1.5, Math.min(w,h)*0.08);
  if(mt==='mac'){
    return `<svg width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'><line x1='0' y1='${h/2}' x2='${w}' y2='${h/2}' stroke='currentColor' stroke-width='${sw*1.6}' stroke-linecap='round'/></svg>`;
  }
  if(mt==='top' || mt==='bot'){
    const rx=w*0.48, ry=h*0.48;
    return `<svg width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'><ellipse cx='${w/2}' cy='${h/2}' rx='${rx}' ry='${ry}' fill='none' stroke='currentColor' stroke-width='${sw}'/></svg>`;
  }
  if(mt==='tilde' || mt==='tilde_top'){
    const y=h*0.55;
    return `<svg width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'><path d='M0 ${y} C ${w*0.2} ${y-h*0.45}, ${w*0.3} ${y+h*0.45}, ${w*0.5} ${y} C ${w*0.7} ${y-h*0.45}, ${w*0.8} ${y+h*0.45}, ${w} ${y}' fill='none' stroke='currentColor' stroke-width='${sw*1.4}' stroke-linecap='round'/></svg>`;
  }
  if(mt==='tri'){
    return `<svg width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'><polygon points='0,0 ${w},0 ${w/2},${h}' fill='currentColor'/></svg>`;
  }
  if(mt==='double'){
    const qh=h*0.85;
    return `<svg width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'><path d='M${w*0.25},${h} L${w*0.45},${h-qh}' stroke='currentColor' stroke-width='${sw*1.6}'/><path d='M${w*0.55},${h} L${w*0.75},${h-qh}' stroke='currentColor' stroke-width='${sw*1.6}'/></svg>`;
  }
  if(mt==='caron'){
    return `<svg width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'><polyline points='${w*0.05},${h*0.25} ${w*0.5},${h*0.85} ${w*0.95},${h*0.25}' fill='none' stroke='currentColor' stroke-width='${sw*1.4}' stroke-linecap='round' stroke-linejoin='round'/></svg>`;
  }
  if(mt==='ya'){
    return `<svg width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'><polyline points='${w*0.15},${h*0.2} ${w*0.5},${h*0.8} ${w*0.85},${h*0.2}' fill='none' stroke='currentColor' stroke-width='${sw*1.2}'/><polyline points='${w*0.15},${h*0.55} ${w*0.5},${h*0.15} ${w*0.85},${h*0.55}' fill='none' stroke='currentColor' stroke-width='${sw*1.2}'/></svg>`;
  }
  return `<svg width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'><circle cx='${w/2}' cy='${h/2}' r='${Math.min(w,h)*0.35}' fill='currentColor'/></svg>`;
}

function updatePickerMarker(){
  const plane = document.getElementById('coordPlane');
  const cross=document.getElementById('pickCross');
  if(!plane || !cross || !picker.key) return;
  const w = Number(picker.w || 140);
  const h = Number(picker.h || 140);
  const mt = keyToMarkType(picker.key);
  const wPx = w * PICK_SCALE;
  const hPx = h * PICK_SCALE;
  cross.innerHTML = markerSvg(mt, wPx, hPx);
  cross.style.width = `${wPx}px`;
  cross.style.height = `${hPx}px`;
  cross.style.left = `${picker.x * PICK_SCALE}px`;
  cross.style.top = `${plane.clientHeight - (picker.y * PICK_SCALE)}px`;
  cross.style.display = 'block';
}

function onPickSizeChange(){
  picker.w = Math.max(1, Number(document.getElementById('pickW')?.value || picker.w || 140));
  picker.h = Math.max(1, Number(document.getElementById('pickH')?.value || picker.h || 140));
  updatePickerUI();
}

function updatePickerUI(){
  const c=document.getElementById('pickCoord');
  if(c) c.textContent = `x: ${Math.round(picker.x)}, y: ${Math.round(picker.y)}`;
  updatePickerMarker();
}
function onPickerMove(evt){
  if(!picker.open) return;
  const plane=document.getElementById('coordPlane');
  const r=plane.getBoundingClientRect();
  let x=(evt.clientX-r.left)/PICK_SCALE;
  let y=(r.bottom-evt.clientY)/PICK_SCALE;
  x=Math.max(0,Math.min(UPM,x));
  y=Math.max(0,Math.min(UPM,y));
  const c=document.getElementById('pickCoord');
  if(c) c.textContent = `x: ${Math.round(x)}, y: ${Math.round(y)}`;
}
function onPickerClick(evt){
  if(!picker.open) return;
  const plane=document.getElementById('coordPlane');
  const r=plane.getBoundingClientRect();
  let x=snap((evt.clientX-r.left)/PICK_SCALE);
  let y=snap((r.bottom-evt.clientY)/PICK_SCALE);
  x=Math.max(0,Math.min(UPM,x));
  y=Math.max(0,Math.min(UPM,y));
  picker.x=x; picker.y=y;
  updatePickerUI();
}
function applyPickedToInputs(){
  if(!picker.key) return;
  document.getElementById(picker.key+'_x').value = Math.round(picker.x);
  document.getElementById(picker.key+'_y').value = Math.round(picker.y);
  document.getElementById(picker.key+'_w').value = Math.round(picker.w);
  document.getElementById(picker.key+'_h').value = Math.round(picker.h);
  state[picker.key] = readOne(picker.key);
  document.getElementById('msg').textContent = `${picker.key} 정밀값 적용 (x=${Math.round(picker.x)}, y=${Math.round(picker.y)}, w=${Math.round(picker.w)}, h=${Math.round(picker.h)})`;
}
async function applyPickedAndSave(){
  applyPickedToInputs();
  await saveOne(picker.key);
}
function nudge(dx,dy){
  if(!picker.open) return;
  picker.x = Math.max(0, picker.x + dx);
  picker.y = Math.max(0, picker.y + dy);
  updatePickerUI();
}
window.addEventListener('keydown',(e)=>{
  if(!picker.open) return;
  if(e.key==='Escape'){ closePicker(); return; }
  if(e.key==='ArrowLeft'){ e.preventDefault(); nudge(-1,0);}
  if(e.key==='ArrowRight'){ e.preventDefault(); nudge(1,0);}
  if(e.key==='ArrowUp'){ e.preventDefault(); nudge(0,1);}
  if(e.key==='ArrowDown'){ e.preventDefault(); nudge(0,-1);}
});


function selectedAddMarks(){
  return Array.from(document.querySelectorAll('#add_marks input[type=checkbox]:checked')).map(x=>x.value);
}
function renderAddMarkOptions(){
  const host=document.getElementById('add_marks');
  host.innerHTML = MARK_ORDER.map(m=>`<label><input type='checkbox' value='${m}' onchange='onAddMarksChange()'> ${MARK_LABEL[m]}</label>`).join('');
}
function onAddMarksChange(){
  const marks=selectedAddMarks();
  if(marks.length>2){
    const last=marks[marks.length-1];
    const el=document.querySelector(`#add_marks input[value='${last}']`);
    if(el) el.checked=false;
    document.getElementById('msg').textContent='기호는 최대 2개까지 선택 가능해요.';
  }
  refreshAddPreviewGlyph();
}
function refreshAddPreviewGlyph(){
  const base=(document.getElementById('add_base').value||'가').trim().slice(0,1);
  const marks=selectedAddMarks();
  const sig=normalizeSig(marks);
  const arr=sig?sig.split('+'):[];
  const sample=base + arr.map(m=>MARK_CHAR[m]||'').join('');
  document.getElementById('add_pick_glyph').textContent = sample || base;
}
function openAddCardModal(){
  const gsel=document.getElementById('add_group');
  gsel.innerHTML = GROUP_ORDER.map(g=>`<option value='${g}' ${group===g?'selected':''}>${GROUP_LABEL[g]}</option>`).join('');
  renderAddMarkOptions();
  document.getElementById('add_base').value='';
  addDraft={x:null,y:null};
  document.getElementById('add_pick_coord').textContent='x: -, y: -';
  document.getElementById('add_pick_cross').style.display='none';
  refreshAddPreviewGlyph();
  document.getElementById('addCardModal').classList.add('open');
}
function closeAddCardModal(){ document.getElementById('addCardModal').classList.remove('open'); }
function closeAddCardByBackdrop(e){ if(e.target.id==='addCardModal') closeAddCardModal(); }
function onAddPickMove(evt){
  const r=evt.currentTarget.getBoundingClientRect();
  const x=evt.clientX-r.left; const y=r.bottom-evt.clientY;
  document.getElementById('add_pick_coord').textContent=`x: ${Math.round(x)}, y: ${Math.round(y)}`;
}
function onAddPickClick(evt){
  const r=evt.currentTarget.getBoundingClientRect();
  const x=evt.clientX-r.left; const y=r.bottom-evt.clientY;
  addDraft={x:Math.round(x),y:Math.round(y)};
  const c=document.getElementById('add_pick_cross');
  c.style.display='block'; c.style.left=`${x}px`; c.style.top=`${r.height-y}px`;
  document.getElementById('add_pick_coord').textContent=`x: ${addDraft.x}, y: ${addDraft.y}`;
}
function firstCoordsByType(mt, g){
  const pool=(ITEMS[g]||[]);
  const found=pool.find(it=>keyToMarkType(it.key)===mt && state[it.key]);
  if(found) return {...state[found.key]};
  const any=allItems().find(it=>keyToMarkType(it.key)===mt && state[it.key]);
  if(any) return {...state[any.key]};
  return {x:400,y:700,width:140,height:140};
}
function nextStemIndex(g){
  let max=0;
  (ITEMS[g]||[]).forEach(it=>{
    const m=it.key.match(new RegExp(`^${g}(\d+)_`));
    if(m) max=Math.max(max,parseInt(m[1],10));
  });
  return max+1;
}
function stemMapForGroup(g){
  const m={};
  (ITEMS[g]||[]).forEach(it=>{
    const st=stemKey(it.key); const mt=keyToMarkType(it.key);
    m[st]=m[st]||{base:(it.sample||'').slice(0,1),marks:[]};
    if(mt && !m[st].marks.includes(mt)) m[st].marks.push(mt);
  });
  return m;
}
async function createCardFromModal(){
  const g=document.getElementById('add_group').value;
  const base=(document.getElementById('add_base').value||'').trim().slice(0,1);
  const marks=normalizeSig(selectedAddMarks()).split('+').filter(Boolean);
  if(!g||!base||marks.length===0){ alert('계열/글자/기호를 확인해 주세요.'); return; }
  if(marks.length>2){ alert('기호는 최대 2개까지 가능합니다.'); return; }

  const sig=normalizeSig(marks);
  const stemInfo=stemMapForGroup(g);
  const dup=Object.entries(stemInfo).find(([st,v])=> v.base===base && normalizeSig(v.marks)===sig);
  if(dup){ alert(`이미 같은 조합이 있어요: ${dup[0]}`); return; }

  const n=nextStemIndex(g);
  const stem=`${g}${n}`;
  const sample=base + marks.map(m=>MARK_CHAR[m]||'').join('');
  const newItems=[]; const keys={};

  function setCoord(k,mt){
    const c=firstCoordsByType(mt,g);
    if(addDraft.x!=null&&addDraft.y!=null){ c.x=addDraft.x; c.y=addDraft.y; }
    state[k]=c;
  }

  if(marks.length===1){
    const m=marks[0]; const k=`${stem}_${m}`; keys[m]=k;
    newItems.push({key:k,title:`${n}) ${base}+${MARK_LABEL[m]}`,sample});
    setCoord(k,m);
  }else{
    const [m1,m2]=marks;
    const k1=`${stem}_${m1}`, k2=`${stem}_${m2}`;
    keys[m1]=k1; keys[m2]=k2;
    newItems.push({key:k1,title:`${n}-a) ${base}+${MARK_LABEL[m1]}+${MARK_LABEL[m2]}(${MARK_LABEL[m1]})`,sample});
    newItems.push({key:k2,title:`${n}-b) ${base}+${MARK_LABEL[m1]}+${MARK_LABEL[m2]}(${MARK_LABEL[m2]})`,sample});
    setCoord(k1,m1); setCoord(k2,m2);
  }

  ITEMS[g].push(...newItems);
  state.__cards_custom = state.__cards_custom || [];
  state.__cards_custom.push({group:g,stem,base,marks,keys});

  await saveAll(collectAll());
  closeAddCardModal();
  group=g; view='all';
  render();
  document.getElementById('msg').textContent=`새 카드 추가됨: ${stem}`;
}

function render(){
  document.getElementById('tab_all').classList.toggle('on', group==='all');
  document.getElementById('tab_ga').classList.toggle('on', group==='ga');
  document.getElementById('tab_na').classList.toggle('on', group==='na');
  document.getElementById('tab_da').classList.toggle('on', group==='da');
  document.getElementById('tab_ra').classList.toggle('on', group==='ra');
  document.getElementById('tab_ma').classList.toggle('on', group==='ma');
  document.getElementById('tab_ba').classList.toggle('on', group==='ba');
  document.getElementById('tab_sa').classList.toggle('on', group==='sa');
  document.getElementById('tab_a').classList.toggle('on', group==='a');
  document.getElementById('tab_ja').classList.toggle('on', group==='ja');
  document.getElementById('tab_cha').classList.toggle('on', group==='cha');
  document.getElementById('tab_ka').classList.toggle('on', group==='ka');
  document.getElementById('tab_ta').classList.toggle('on', group==='ta');
  document.getElementById('tab_pa').classList.toggle('on', group==='pa');
  document.getElementById('tab_ha').classList.toggle('on', group==='ha');

  VIEW_DEFS.forEach(v=>{
    const el = document.getElementById('view_'+v.key);
    if(el) el.classList.toggle('on', view===v.key);
  });

  const sourceItems = (group==='all') ? allItems() : ITEMS[group];
  const filtered = filterItemsByView(sourceItems);
  document.getElementById('root').innerHTML = filtered.map(card).join('');
  refreshPresetBadge();
}
function setGroup(g){ group=g; render(); }
function readOne(key){
  return {x:+document.getElementById(key+'_x').value,y:+document.getElementById(key+'_y').value,width:+document.getElementById(key+'_w').value,height:+document.getElementById(key+'_h').value}
}
function collectAll(){
  const p={...state};
  Object.values(ITEMS).flat().forEach(it=>{
    const k=it.key; const ex=document.getElementById(k+'_x');
    if(ex) p[k]={x:+document.getElementById(k+'_x').value,y:+document.getElementById(k+'_y').value,width:+document.getElementById(k+'_w').value,height:+document.getElementById(k+'_h').value};
  });
  return p;
}
async function saveAll(payload){
  const r=await fetch('/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
  return await r.json();
}
function copyFromSelected(targetKey){
  const sel=document.getElementById(targetKey+'_src'); const srcKey=sel?sel.value:'';
  if(!srcKey||!state[srcKey]) return;
  const v=state[srcKey];
  document.getElementById(targetKey+'_x').value=v.x; document.getElementById(targetKey+'_y').value=v.y;
  document.getElementById(targetKey+'_w').value=v.width; document.getElementById(targetKey+'_h').value=v.height;
  state[targetKey]={x:v.x,y:v.y,width:v.width,height:v.height};
  document.getElementById('msg').textContent=`${targetKey} <= ${srcKey} 값 불러옴 (저장해야 반영)`;
}
async function saveOne(key){ state[key]=readOne(key); const j=await saveAll(collectAll()); document.getElementById('msg').textContent=j.ok?`${key} 저장됨`:`저장 실패: ${key}`; }
async function applyOne(key){
  state[key]=readOne(key); document.getElementById('msg').textContent=`${key} 반영중...`;
  const s=await saveAll(collectAll()); if(!s.ok){document.getElementById('msg').textContent='저장 실패';return;}
  const r=await fetch('/apply',{method:'POST'}); const j=await r.json();
  document.getElementById('msg').textContent=j.ok?`${key} 폰트 반영 완료`:`반영 실패: ${key}`;
  if(j.ok) location.href='./editor?t='+Date.now();
}
async function applyAll(){
  document.getElementById('msg').textContent='전체 반영중...'; const s=await saveAll(collectAll());
  if(!s.ok){document.getElementById('msg').textContent='전체 저장 실패';return;}
  const r=await fetch('/apply',{method:'POST'}); const j=await r.json();
  document.getElementById('msg').textContent=j.ok?'전체 폰트 반영 완료':'전체 반영 실패';
  if(j.ok) location.href='./editor?t='+Date.now();
}
async function init(){
  const r=await fetch('/params'); state=await r.json();
  document.getElementById('add_base').addEventListener('input', refreshAddPreviewGlyph);
  if(Array.isArray(state.__cards_custom)){
    state.__cards_custom.forEach(c=>{
      const g=c.group, base=c.base, marks=c.marks||[], keys=c.keys||{};
      if(!ITEMS[g]) return;
      const sample=base + marks.map(m=>MARK_CHAR[m]||'').join('');
      if(marks.length===1){
        const m=marks[0], k=keys[m];
        if(k && !ITEMS[g].some(it=>it.key===k)) ITEMS[g].push({key:k,title:`(사용자) ${base}+${MARK_LABEL[m]}`,sample});
      }else if(marks.length===2){
        const [m1,m2]=marks; const k1=keys[m1],k2=keys[m2];
        if(k1 && !ITEMS[g].some(it=>it.key===k1)) ITEMS[g].push({key:k1,title:`(사용자-a) ${base}+${MARK_LABEL[m1]}+${MARK_LABEL[m2]}(${MARK_LABEL[m1]})`,sample});
        if(k2 && !ITEMS[g].some(it=>it.key===k2)) ITEMS[g].push({key:k2,title:`(사용자-b) ${base}+${MARK_LABEL[m1]}+${MARK_LABEL[m2]}(${MARK_LABEL[m2]})`,sample});
      }
    });
  }
  buildViewNav(); render();
}
init();
</script>
</body></html>
